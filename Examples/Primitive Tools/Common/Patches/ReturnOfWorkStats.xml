<?xml version="1.0" encoding="utf-8" ?>

<Patch>

  <!--  =========================  Sculpting, Tailoring, Smithing  ======================================= -->

    <Operation Class="PatchOperationFindMod">
        <success>Always</success>
        <mods>
          <li>De-generalize Work</li>
		  <li>Niilo's QoL</li>
        </mods>		
        <nomatch Class="PatchOperationSequence">			
            <operations>
                <li Class="PatchOperationAdd">					
		          <xpath>Defs</xpath>
		            <value>
						<StatDef ParentName="GeneralLaborSpeed">
							<defName>SculptingSpeed</defName>
							<label>sculpting speed</label>
							<description>The speed at which this person creates sculptures.\n\nThis stat only affects how fast sculptures are produced, not their quality. Quality is determined by the sculptor's artistic skill.</description>
							<statFactors Inherit="False">
								<li>GeneralLaborSpeed</li>
							</statFactors>
							<capacityFactors Inherit="False"/>
						</StatDef>
						<StatDef ParentName="GeneralLaborSpeed">
							<defName>TailoringSpeed</defName>
							<label>tailoring speed</label>
							<description>The speed at which this person makes clothes.\n\nThis stat only affects how fast clothes are produced, not their quality. Quality is determined by the tailor's crafting skill.</description>
							<statFactors Inherit="False">
								<li>GeneralLaborSpeed</li>
							</statFactors>
							<capacityFactors Inherit="False"/>
						</StatDef>
						<StatDef ParentName="GeneralLaborSpeed">
							<defName>SmithingSpeed</defName>
							<label>smithing speed</label>
							<description>Speed at which this person crafts weapons, machinery, and ammunition.\n\nThis stat only affects how fast items are produced, not their quality. Quality is determined by the crafter's skill.</description>
							<statFactors Inherit="False">
								<li>GeneralLaborSpeed</li>
							</statFactors>
							<capacityFactors Inherit="False"/>
						</StatDef>
		            </value>
				</li>
				<li Class="PatchOperationAttributeAdd">
					<xpath>Defs/StatDef[defName="GeneralLaborSpeed"]</xpath>
					<attribute>Name</attribute>
					<value>GeneralLaborSpeed</value>
				</li>
				<li Class="PatchOperationReplace">
					<xpath>Defs/ThingDef/recipeMaker[workSpeedStat="GeneralLaborSpeed" and (effectWorking="Smith" or effectWorking="Smelt" or effectWorking="Cook") and recipeUsers[li="TableMachining" or li="ElectricSmithy" or li="FueledSmithy" or li="VBY_PrimitiveRangedWeaponTable" or li="VBY_PrimitiveMeleeWeaponTable"]]/workSpeedStat</xpath>
					<value>
						<workSpeedStat>SmithingSpeed</workSpeedStat>
					</value>
				</li>				
				<li Class="PatchOperationReplace">
					<xpath>Defs/ThingDef/recipeMaker[workSpeedStat="GeneralLaborSpeed" and effectWorking="Tailor" and recipeUsers[li="ElectricTailoringBench" or li="HandTailoringBench" or li="VBY_PrimitiveTailoringTable"]]/workSpeedStat</xpath> <!--Tailored items at crafting spots could be a problem-->
					<value>
						<workSpeedStat>TailoringSpeed</workSpeedStat>
					</value>
				</li>
				<li Class="PatchOperationReplace">
					<xpath>Defs/RecipeDef[workSpeedStat="GeneralLaborSpeed" and effectWorking="Tailor"]/workSpeedStat</xpath>
					<value>
						<workSpeedStat>TailoringSpeed</workSpeedStat>
					</value>
				</li>				
				<li Class="PatchOperationReplace">
					<xpath>Defs/ThingDef/recipeMaker[workSpeedStat="GeneralLaborSpeed" and effectWorking="Sculpt" and recipeUsers[li="TableSculpting" or li="VBY_PrimitiveKiln" or li="VBY_PrimitiveRangedWeaponTable"]]/workSpeedStat</xpath>
					<value>
						<workSpeedStat>SculptingSpeed</workSpeedStat>
					</value>
				</li>
				<li Class="PatchOperationReplace">
					<xpath>Defs/RecipeDef[workSpeedStat="GeneralLaborSpeed" and effectWorking="Sculpt"]/workSpeedStat</xpath>
					<value>
						<workSpeedStat>SculptingSpeed</workSpeedStat>
					</value>
				</li>
			</operations>
        </nomatch>
	</Operation>
	
	<Operation Class="PatchOperationFindMod">
        <success>Always</success>
        <mods>
          <li>De-generalize Work</li>
		  <li>Niilo's QoL</li>
        </mods>		
        <match Class="PatchOperationSequence">			
            <operations>
			   <li Class="PatchOperationReplace">
					<xpath>Defs/ThingDef/recipeMaker[workSpeedStat="GeneralLaborSpeed" and (effectWorking="Smith" or effectWorking="Smelt" or effectWorking="Cook") and recipeUsers[li="VBY_PrimitiveRangedWeaponTable" or li="VBY_PrimitiveMeleeWeaponTable"]]/workSpeedStat</xpath>
					<value>
						<workSpeedStat>SmithingSpeed</workSpeedStat>
					</value>
				</li>				
				<li Class="PatchOperationReplace">
					<xpath>Defs/ThingDef/recipeMaker[workSpeedStat="GeneralLaborSpeed" and effectWorking="Tailor" and recipeUsers[li="VBY_PrimitiveTailoringTable"]]/workSpeedStat</xpath> <!--Tailored items at crafting spots could be a problem-->
					<value>
						<workSpeedStat>TailoringSpeed</workSpeedStat>
					</value>
				</li>
				<li Class="PatchOperationReplace">
					<xpath>Defs/RecipeDef[workSpeedStat="GeneralLaborSpeed" and effectWorking="Sculpt"]/workSpeedStat</xpath>
					<value>
						<workSpeedStat>SculptingSpeed</workSpeedStat>
					</value>
				</li>			
			</operations>
        </match>
	</Operation>
	
	<!--  =========================  Stonecutting  ======================================= -->
	
	<Operation Class="PatchOperationFindMod">
        <success>Always</success>
        <mods>
          <li>Skilled Stonecutting</li>
          <li>Skilled Stonecutting [1.3]</li>
          <li>Stonecutting Extended</li>
		  <li>Niilo's QoL</li>
        </mods>		
        <nomatch Class="PatchOperationSequence">			
            <operations>
                <li Class="PatchOperationAdd">					
		          <xpath>Defs</xpath>
		            <value>
						<StatDef>
							<defName>StonecuttingSpeed</defName>
							<label>stonecutting speed</label>
							<description>Speed at which this person cuts rough stone into blocks.</description>
							<category>PawnWork</category>
							<defaultBaseValue>1</defaultBaseValue>
							<toStringStyle>PercentZero</toStringStyle>
							<statFactors>
								<li>WorkSpeedGlobal</li>
							</statFactors>
							<skillNeedFactors>
								<li Class="SkillNeed_BaseBonus">
								<skill>Crafting</skill>
								<baseValue>0.8</baseValue>
								<bonusPerLevel>0.075</bonusPerLevel>
								</li>
							</skillNeedFactors>
							<capacityFactors>
								<li>
									<capacity>Sight</capacity>
									<weight>0.3</weight>
								</li>
								<li>
									<capacity>Manipulation</capacity>
									<weight>0.9</weight>
								</li>
							</capacityFactors>
						</StatDef>
		            </value>
				</li>
				<li Class="PatchOperationAdd">
					<xpath>Defs/RecipeDef[@Name = "MakeStoneBlocksBase"]</xpath>
					<value>
						<workSkill>Crafting</workSkill>
						<workSkillLearnFactor>0.25</workSkillLearnFactor>
					</value>
				</li>
				<li Class="PatchOperationReplace">
					<xpath>Defs/RecipeDef[@Name = "MakeStoneBlocksBase"]/workSpeedStat</xpath>
					<value>
						<workSpeedStat>StonecuttingSpeed</workSpeedStat>
					</value>
				</li>
				<li Class="PatchOperationReplace">
					<xpath>Defs/ThingDef/recipeMaker[workSpeedStat="GeneralLaborSpeed" and effectWorking="CutStone" and recipeUsers[li="TableStonecutter" or li="VBY_PrimitiveStoneCuttingSpot" or li="VBY_PrimitiveStoneCuttingTable"]]/workSpeedStat</xpath>
					<value>
						<workSpeedStat>StonecuttingSpeed</workSpeedStat>
					</value>
				</li>
				<li Class="PatchOperationReplace">
					<xpath>Defs/RecipeDef[workSpeedStat="GeneralLaborSpeed" and effectWorking="CutStone"]/workSpeedStat</xpath>
					<value>
						<workSpeedStat>StonecuttingSpeed</workSpeedStat>
					</value>
				</li>
			</operations>
        </nomatch>
	</Operation>
	
	
	<Operation Class="PatchOperationFindMod">
        <success>Always</success>
        <mods>
          <li>Skilled Stonecutting</li>
          <li>Skilled Stonecutting [1.3]</li>
		  <li>Toolmetrics Redux (Continued)</li>
          <li>Stonecutting Extended</li>
		  <li>Niilo's QoL</li>
        </mods>		
        <match Class="PatchOperationSequence">			
            <operations>
			  <li Class="PatchOperationReplace">
					<xpath>Defs/ThingDef/recipeMaker[workSpeedStat="GeneralLaborSpeed" and effectWorking="CutStone" and recipeUsers[li="TableStonecutter" or li="VBY_PrimitiveStoneCuttingSpot" or li="VBY_PrimitiveStoneCuttingTable"]]/workSpeedStat</xpath>
					<value>
						<workSpeedStat>StonecuttingSpeed</workSpeedStat>
					</value>
			  </li>			
			  <li Class="PatchOperationReplace">
					<xpath>Defs/RecipeDef[workSpeedStat="GeneralLaborSpeed" and effectWorking="CutStone"]/workSpeedStat</xpath>
					<value>
						<workSpeedStat>StonecuttingSpeed</workSpeedStat>
					</value>
			  </li>		
			</operations>
        </match>
	</Operation>
	
</Patch>	